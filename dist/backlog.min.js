(function(o,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("qs")):typeof define=="function"&&define.amd?define(["exports","qs"],a):(o=typeof globalThis<"u"?globalThis:o||self,a(o.Backlog={},o.qs))})(this,(function(o,a){"use strict";function b(s){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(s){for(const t in s)if(t!=="default"){const r=Object.getOwnPropertyDescriptor(s,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:()=>s[t]})}}return e.default=s,Object.freeze(e)}const q=b(a);class h extends Error{constructor(e,t,r){super(t.statusText),this._name=e,this._url=t.url,this._status=t.status,this._body=r,this._response=t}get name(){return this._name}get url(){return this._url}get status(){return this._status}get body(){return this._body}get response(){return this._response}}class g extends h{constructor(e,t){super("BacklogApiError",e,t)}}class m extends h{constructor(e,t){super("BacklogAuthError",e,t)}}class p extends h{constructor(e){super("UnexpectedError",e)}}const U=Object.freeze(Object.defineProperty({__proto__:null,BacklogApiError:g,BacklogAuthError:m,BacklogError:h,UnexpectedError:p},Symbol.toStringTag,{value:"Module"}));class d{constructor(e){this.configure=e}get(e,t){return this.request({method:"GET",path:e,params:t}).then(this.parseJSON)}post(e,t){return this.request({method:"POST",path:e,params:t}).then(this.parseJSON)}put(e,t){return this.request({method:"PUT",path:e,params:t}).then(this.parseJSON)}patch(e,t){return this.request({method:"PATCH",path:e,params:t}).then(this.parseJSON)}delete(e,t){return this.request({method:"DELETE",path:e,params:t}).then(this.parseJSON)}request(e){const{method:t,path:r,params:i={}}=e,{apiKey:n,accessToken:c,timeout:w}=this.configure,P=n?{apiKey:n}:{},u={method:t,headers:{}};w&&(u.timeout=w),!n&&c&&(u.headers.Authorization="Bearer "+c),typeof window<"u"&&(u.mode="cors"),t!=="GET"?i instanceof FormData?u.body=i:(u.headers["Content-type"]="application/x-www-form-urlencoded",u.body=this.toQueryString(i)):Object.keys(i).forEach(S=>P[S]=i[S]);const I=this.toQueryString(P),F=`${this.restBaseURL}/${r}`+(I.length>0?`?${I}`:"");return fetch(F,u).then(this.checkStatus)}checkStatus(e){return new Promise((t,r)=>{200<=e.status&&e.status<300?t(e):e.json().then(i=>{e.status===401?r(new m(e,i)):r(new g(e,i))}).catch(i=>r(new p(e)))})}parseJSON(e){return e.status===204||e.headers.get("Content-Length")==="0"?Promise.resolve(void 0):e.json()}toQueryString(e){const t={};return Object.keys(e).forEach(r=>{const i=e[r];r.startsWith("customField_")&&Array.isArray(i)?i.forEach((n,c)=>{t[`${r}[${c}]`]=n}):t[r]=i}),q.stringify(t,{arrayFormat:"brackets"})}get webAppBaseURL(){return`https://${this.configure.host}`}get restBaseURL(){return`${this.webAppBaseURL}/api/v2`}}class R extends d{constructor(e){super(e)}getSpace(){return this.get("space")}getSpaceActivities(e){return this.get("space/activities",e)}getSpaceIcon(){return this.download("space/image")}getSpaceNotification(){return this.get("space/notification")}putSpaceNotification(e){return this.put("space/notification",e)}getSpaceDiskUsage(){return this.get("space/diskUsage")}postSpaceAttachment(e){return this.upload("space/attachment",e)}getUsers(){return this.get("users")}getUser(e){return this.get(`users/${e}`)}postUser(e){return this.post("users",e)}patchUser(e,t){return this.patch(`users/${e}`,t)}deleteUser(e){return this.delete(`users/${e}`)}getMyself(){return this.get("users/myself")}getUserIcon(e){return this.download(`users/${e}/icon`)}getUserActivities(e,t){return this.get(`users/${e}/activities`,t)}getUserStars(e,t){return this.get(`users/${e}/stars`,t)}getUserStarsCount(e,t){return this.get(`users/${e}/stars/count`,t)}getRecentlyViewedIssues(e){return this.get("users/myself/recentlyViewedIssues",e)}getRecentlyViewedProjects(e){return this.get("users/myself/recentlyViewedProjects",e)}getRecentlyViewedWikis(e){return this.get("users/myself/recentlyViewedWikis",e)}getProjectStatuses(e){return this.get(`projects/${e}/statuses`)}getResolutions(){return this.get("resolutions")}getPriorities(){return this.get("priorities")}getProjects(e){return this.get("projects",e)}postProject(e){return this.post("projects",e)}getProject(e){return this.get(`projects/${e}`)}patchProject(e,t){return this.patch(`projects/${e}`,t)}deleteProject(e){return this.delete(`projects/${e}`)}getProjectIcon(e){return this.download(`projects/${e}/image`)}getProjectActivities(e,t){return this.get(`projects/${e}/activities`,t)}postProjectUser(e,t){return this.post(`projects/${e}/users`,{userId:t})}getProjectUsers(e){return this.get(`projects/${e}/users`)}deleteProjectUsers(e,t){return this.delete(`projects/${e}/users`,t)}postProjectAdministrators(e,t){return this.post(`projects/${e}/administrators`,t)}getProjectAdministrators(e){return this.get(`projects/${e}/administrators`)}deleteProjectAdministrators(e,t){return this.delete(`projects/${e}/administrators`,t)}postProjectStatus(e,t){return this.post(`projects/${e}/statuses`,t)}patchProjectStatus(e,t,r){return this.patch(`projects/${e}/statuses/${t}`,r)}deleteProjectStatus(e,t,r){return this.delete(`projects/${e}/statuses/${t}`,{substituteStatusId:r})}patchProjectStatusOrder(e,t){return this.patch(`projects/${e}/statuses/updateDisplayOrder`,{statusId:t})}getIssueTypes(e){return this.get(`projects/${e}/issueTypes`)}postIssueType(e,t){return this.post(`projects/${e}/issueTypes`,t)}patchIssueType(e,t,r){return this.patch(`projects/${e}/issueTypes/${t}`,r)}deleteIssueType(e,t,r){return this.delete(`projects/${e}/issueTypes/${t}`,r)}getCategories(e){return this.get(`projects/${e}/categories`)}postCategories(e,t){return this.post(`projects/${e}/categories`,t)}patchCategories(e,t,r){return this.patch(`projects/${e}/categories/${t}`,r)}deleteCategories(e,t){return this.delete(`projects/${e}/categories/${t}`)}getVersions(e){return this.get(`projects/${e}/versions`)}postVersions(e,t){return this.post(`projects/${e}/versions`,t)}patchVersions(e,t,r){return this.patch(`projects/${e}/versions/${t}`,r)}deleteVersions(e,t){return this.delete(`projects/${e}/versions/${t}`)}getCustomFields(e){return this.get(`projects/${e}/customFields`)}postCustomField(e,t){return this.post(`projects/${e}/customFields`,t)}patchCustomField(e,t,r){return this.patch(`projects/${e}/customFields/${t}`,r)}deleteCustomField(e,t){return this.delete(`projects/${e}/customFields/${t}`)}postCustomFieldItem(e,t,r){return this.post(`projects/${e}/customFields/${t}/items`,r)}patchCustomFieldItem(e,t,r,i){return this.patch(`projects/${e}/customFields/${t}/items/${r}`,i)}deleteCustomFieldItem(e,t,r){return this.delete(`projects/${e}/customFields/${t}/items/${r}`)}getSharedFiles(e,t,r){return this.get(`projects/${e}/files/metadata/${t}`,r)}getSharedFile(e,t){return this.download(`projects/${e}/files/${t}`)}getProjectsDiskUsage(e){return this.get(`projects/${e}/diskUsage`)}getWebhooks(e){return this.get(`projects/${e}/webhooks`)}postWebhook(e,t){return this.post(`projects/${e}/webhooks`,t)}getWebhook(e,t){return this.get(`projects/${e}/webhooks/${t}`)}patchWebhook(e,t,r){return this.patch(`projects/${e}/webhooks/${t}`,r)}deleteWebhook(e,t){return this.delete(`projects/${e}/webhooks/${t}`)}getIssues(e){return this.get("issues",e)}getIssuesCount(e){return this.get("issues/count",e)}postIssue(e){return this.post("issues",e)}patchIssue(e,t){return this.patch(`issues/${e}`,t)}getIssue(e){return this.get(`issues/${e}`)}deleteIssue(e){return this.delete(`issues/${e}`)}getIssueComments(e,t){return this.get(`issues/${e}/comments`,t)}postIssueComments(e,t){return this.post(`issues/${e}/comments`,t)}getIssueCommentsCount(e){return this.get(`issues/${e}/comments/count`)}getIssueComment(e,t){return this.get(`issues/${e}/comments/${t}`)}deleteIssueComment(e,t){return this.delete(`issues/${e}/comments/${t}`)}patchIssueComment(e,t,r){return this.patch(`issues/${e}/comments/${t}`,r)}getIssueCommentNotifications(e,t){return this.get(`issues/${e}/comments/${t}/notifications`)}postIssueCommentNotifications(e,t,r){return this.post(`issues/${e}/comments/${t}/notifications`,r)}getIssueAttachments(e){return this.get(`issues/${e}/attachments`)}getIssueAttachment(e,t){return this.download(`issues/${e}/attachments/${t}`)}deleteIssueAttachment(e,t){return this.delete(`issues/${e}/attachments/${t}`)}getIssueParticipants(e){return this.get(`issues/${e}/participants`)}getIssueSharedFiles(e){return this.get(`issues/${e}/sharedFiles`)}linkIssueSharedFiles(e,t){return this.post(`issues/${e}/sharedFiles`,t)}unlinkIssueSharedFile(e,t){return this.delete(`issues/${e}/sharedFiles/${t}`)}getWikis(e){return this.get("wikis",e)}getWikisCount(e){return this.get("wikis/count",{projectIdOrKey:e})}getWikisTags(e){return this.get("wikis/tags",{projectIdOrKey:e})}postWiki(e){return this.post("wikis",e)}getWiki(e){return this.get(`wikis/${e}`)}patchWiki(e,t){return this.patch(`wikis/${e}`,t)}deleteWiki(e,t){return this.delete(`wikis/${e}`,{mailNotify:t})}getWikisAttachments(e){return this.get(`wikis/${e}/attachments`)}postWikisAttachments(e,t){return this.post(`wikis/${e}/attachments`,{attachmentId:t})}getWikiAttachment(e,t){return this.download(`wikis/${e}/attachments/${t}`)}deleteWikisAttachments(e,t){return this.delete(`wikis/${e}/attachments/${t}`)}getWikisSharedFiles(e){return this.get(`wikis/${e}/sharedFiles`)}linkWikisSharedFiles(e,t){return this.post(`wikis/${e}/sharedFiles`,{fileId:t})}unlinkWikisSharedFiles(e,t){return this.delete(`wikis/${e}/sharedFiles/${t}`)}getDocuments(e){return this.get("documents",e)}getDocumentTree(e){return this.get("documents/tree",{projectIdOrKey:e})}getDocument(e){return this.get(`documents/${e}`)}downloadDocumentAttachment(e,t){return this.download(`documents/${e}/attachments/${t}`)}addDocument(e){return this.post("documents",e)}deleteDocument(e){return this.delete(`documents/${e}`)}getWikisHistory(e,t){return this.get(`wikis/${e}/history`,t)}getWikisStars(e){return this.get(`wikis/${e}/stars`)}postStar(e){return this.post("stars",e)}removeStar(e){const t=`stars/${e}`;return this.delete(t)}getNotifications(e){return this.get("notifications",e)}getNotificationsCount(e){return this.get("notifications/count",e)}resetNotificationsMarkAsRead(){return this.post("notifications/markAsRead")}markAsReadNotification(e){return this.post(`notifications/${e}/markAsRead`)}getGitRepositories(e){return this.get(`projects/${e}/git/repositories`)}getGitRepository(e,t){return this.get(`projects/${e}/git/repositories/${t}`)}getPullRequests(e,t,r){return this.get(`projects/${e}/git/repositories/${t}/pullRequests`,r)}getPullRequestsCount(e,t,r){return this.get(`projects/${e}/git/repositories/${t}/pullRequests/count`,r)}postPullRequest(e,t,r){return this.post(`projects/${e}/git/repositories/${t}/pullRequests`,r)}getPullRequest(e,t,r){return this.get(`projects/${e}/git/repositories/${t}/pullRequests/${r}`)}patchPullRequest(e,t,r,i){return this.patch(`projects/${e}/git/repositories/${t}/pullRequests/${r}`,i)}getPullRequestComments(e,t,r,i){return this.get(`projects/${e}/git/repositories/${t}/pullRequests/${r}/comments`,i)}postPullRequestComments(e,t,r,i){return this.post(`projects/${e}/git/repositories/${t}/pullRequests/${r}/comments`,i)}getPullRequestCommentsCount(e,t,r){return this.get(`projects/${e}/git/repositories/${t}/pullRequests/${r}/comments/count`)}patchPullRequestComments(e,t,r,i,n){return this.patch(`projects/${e}/git/repositories/${t}/pullRequests/${r}/comments/${i}`,n)}getPullRequestAttachments(e,t,r){return this.get(`projects/${e}/git/repositories/${t}/pullRequests/${r}/attachments`)}getPullRequestAttachment(e,t,r,i){return this.download(`projects/${e}/git/repositories/${t}/pullRequests/${r}/attachments/${i}`)}deletePullRequestAttachment(e,t,r,i){return this.get(`projects/${e}/git/repositories/${t}/pullRequests/${r}/attachments/${i}`)}getWatchingListItems(e,t){return this.get(`users/${e}/watchings`,t)}getWatchingListCount(e,t){return this.get(`users/${e}/watchings/count`,t)}getWatchingListItem(e){return this.get(`watchings/${e}`)}postWatchingListItem(e){return this.post("watchings",e)}patchWatchingListItem(e,t){return this.patch(`watchings/${e}`,{note:t})}deletehWatchingListItem(e){return this.delete(`watchings/${e}`)}resetWatchingListItemAsRead(e){return this.post(`watchings/${e}/markAsRead`)}getLicence(){return this.get("space/licence")}getTeams(e){return this.get("teams",e)}postTeam(e){return this.post("teams",e)}getTeam(e){return this.get(`teams/${e}`)}patchTeam(e,t){return this.patch(`teams/${e}`,t)}deleteTeam(e){return this.delete(`teams/${e}`)}getTeamIcon(e){return this.download(`teams/${e}/icon`)}getProjectTeams(e){return this.get(`projects/${e}/teams`)}postProjectTeam(e,t){return this.post(`projects/${e}/teams`,{teamId:t})}deleteProjectTeam(e,t){return this.delete(`projects/${e}/teams`,{teamId:t})}getRateLimit(){return this.get("rateLimit")}download(e){return this.request({method:"GET",path:e}).then(this.parseFileData)}upload(e,t){return this.request({method:"POST",path:e,params:t}).then(this.parseJSON)}parseFileData(e){return new Promise((t,r)=>{if(typeof window<"u")t({body:e.body,url:e.url,blob:()=>e.blob()});else{const i=e.headers.get("Content-Disposition"),n=i?i.substring(i.indexOf("''")+2):"";t({body:e.body,url:e.url,filename:n})}})}}class _{constructor(e,t){this.credentials=e,this.timeout=t}getAuthorizationURL(e){const t={client_id:this.credentials.clientId,response_type:"code",redirect_uri:e.redirectUri,state:e.state};return`https://${e.host}/OAuth2AccessRequest.action?`+Object.keys(t).map(r=>t[r]?`${r}=${t[r]}`:"").filter(r=>r.length>0).join("&")}getAccessToken(e){return new d({host:e.host,timeout:this.timeout}).post("oauth2/token",{grant_type:"authorization_code",code:e.code,client_id:this.credentials.clientId,client_secret:this.credentials.clientSecret,redirect_uri:e.redirectUri})}refreshAccessToken(e){return new d({host:e.host,timeout:this.timeout}).post("oauth2/token",{grant_type:"refresh_token",client_id:this.credentials.clientId,client_secret:this.credentials.clientSecret,refresh_token:e.refreshToken})}}var l;(s=>{(e=>{e[e.All=0]="All",e[e.NotChild=1]="NotChild",e[e.Child=2]="Child",e[e.NotChildNotParent=3]="NotChildNotParent",e[e.Parent=4]="Parent"})(s.ParentChildType||(s.ParentChildType={}))})(l||(l={}));const O=Object.freeze(Object.defineProperty({__proto__:null,get Issue(){return l}},Symbol.toStringTag,{value:"Module"})),W=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));var $=(s=>(s[s.Admin=1]="Admin",s[s.User=2]="User",s[s.Reporter=3]="Reporter",s[s.Viewer=4]="Viewer",s[s.GuestReporter=5]="GuestReporter",s[s.GuestViewer=6]="GuestViewer",s))($||{}),j=(s=>(s[s.Admin=1]="Admin",s[s.MemberOrGuest=2]="MemberOrGuest",s[s.MemberOrGuestForAddIssues=3]="MemberOrGuestForAddIssues",s[s.MemberOrGuestForViewIssues=4]="MemberOrGuestForViewIssues",s))(j||{}),f=(s=>(s[s.Undefined=-1]="Undefined",s[s.IssueCreated=1]="IssueCreated",s[s.IssueUpdated=2]="IssueUpdated",s[s.IssueCommented=3]="IssueCommented",s[s.IssueDeleted=4]="IssueDeleted",s[s.WikiCreated=5]="WikiCreated",s[s.WikiUpdated=6]="WikiUpdated",s[s.WikiDeleted=7]="WikiDeleted",s[s.FileAdded=8]="FileAdded",s[s.FileUpdated=9]="FileUpdated",s[s.FileDeleted=10]="FileDeleted",s[s.SvnCommitted=11]="SvnCommitted",s[s.GitPushed=12]="GitPushed",s[s.GitRepositoryCreated=13]="GitRepositoryCreated",s[s.IssueMultiUpdated=14]="IssueMultiUpdated",s[s.ProjectUserAdded=15]="ProjectUserAdded",s[s.ProjectUserRemoved=16]="ProjectUserRemoved",s[s.NotifyAdded=17]="NotifyAdded",s[s.PullRequestAdded=18]="PullRequestAdded",s[s.PullRequestUpdated=19]="PullRequestUpdated",s[s.PullRequestCommented=20]="PullRequestCommented",s[s.PullRequestMerged=21]="PullRequestMerged",s[s.MilestoneCreated=22]="MilestoneCreated",s[s.MilestoneUpdated=23]="MilestoneUpdated",s[s.MilestoneDeleted=24]="MilestoneDeleted",s[s.ProjectGroupAdded=25]="ProjectGroupAdded",s[s.ProjectGroupDeleted=26]="ProjectGroupDeleted",s))(f||{}),k=(s=>(s[s.Text=1]="Text",s[s.TextArea=2]="TextArea",s[s.Numeric=3]="Numeric",s[s.Date=4]="Date",s[s.SingleList=5]="SingleList",s[s.MultipleList=6]="MultipleList",s[s.CheckBox=7]="CheckBox",s[s.Radio=8]="Radio",s))(k||{});const D=Object.freeze(Object.defineProperty({__proto__:null,ActivityType:f,ClassicRoleType:$,CustomFieldType:k,NormalRoleType:j},Symbol.toStringTag,{value:"Module"}));o.Backlog=R,o.Entity=W,o.Error=U,o.OAuth2=_,o.Option=O,o.Types=D,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"})}));
